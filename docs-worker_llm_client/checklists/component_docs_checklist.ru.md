# Чек-лист готовности документации и спецификаций компонента к декомпозиции

Этот чек-лист помогает решить, можно ли по текущей документации/спекам компонента безопасно начинать планирование и декомпозицию на эпики.

См. также: [docs_reference_structure.ru.md](docs_reference_structure.ru.md) (рекомендуемое дерево документов и сопоставление с пунктами чек-листа).

## 1. Критически необходимые пункты  
_Без этого декомпозицию начинать нельзя._

- [ ] **Чёткое позиционирование компонента и границы ответственности**
  - Есть 1–2 предложения “что это за компонент”.
  - Понятно, кто его вызывает и кому он отдаёт результат.
  - Явно перечислено, что **не входит** в его ответственность.

- [ ] **Роль компонента в архитектуре**
  - Список входящих источников (сервисы, воркеры, триггеры, очереди, HTTP и т.п.).
  - Список исходящих потребителей/зависимостей (БД, очереди, внешние API, другие воркеры).

- [ ] **Доменные сущности и жизненный цикл**
  - Перечень ключевых сущностей/документов, с которыми компонент работает.
  - Для каждой сущности описаны допустимые статусы/флаги и правила переходов (включая ретраи/повторные события).

- [ ] **Ключевые инварианты**
  - Явный список правил “нельзя нарушать” (нет silent‑drops, идемпотентность, одно событие → не больше одного эффекта и т.п.).
  - Есть примеры нарушений (контрпримеры), чтобы не было двусмысленности.

- [ ] **Основные сценарии поведения (чёрный ящик)**
  - Описано 3–10 сценариев вида:  
    “Вход: событие/запрос X → Выход: состояние/артефакты Y”.
  - Для каждого сценария понятно, что считается успехом и как выглядит ошибка на доменном уровне.

- [ ] **Полный перечень внешних интерфейсов**
  - Перечислены все типы входов (CloudEvent/очереди/HTTP/cron/CLI и т.п.).
  - Перечислены все важные исходящие вызовы (внешние API, внутренние сервисы, хранилища).

- [ ] **Формальные схемы ключевых данных**
  - Для основных входов и выходов есть формальные схемы (JSON Schema / proto / OpenAPI и т.п.).
  - Как минимум описана структура “главного” входного документа и “главного” выходного артефакта/патча.

- [ ] **Минимальный словарь кодов ошибок**
  - Есть единый список доменных кодов ошибок (валидация, внешние API, хранилища, лимиты и т.п.).
  - Для каждого кода одним абзацем описано, когда именно он должен использоваться.

- [ ] **Идемпотентность и поведение при ретраях**
  - Описано, какие операции должны быть идемпотентны и за счёт каких ключей (idempotency key, детерминированные пути и т.д.).
  - Описано, что происходит при повторном приходе того же события / повторном вызове того же запроса.

- [ ] **Минимальные требования к безопасности и приватности**
  - Перечень чувствительных полей (секреты, PII, токены, ключи).
  - Жёсткие правила: где такие данные **категорически запрещены** (логи, имена файлов, публичные артефакты).

- [ ] **Минимальный контракт логов**
  - Список обязательных полей структурного лога для корреляции  
    (минимум: `service`, `env`, один/несколько идентификаторов для корреляции, `severity`, `error.code` при ошибках).
  - Перечень ключевых событий, которые **обязаны** логироваться (ingest, ключевые шаги обработки, завершение операции).

- [ ] **Естественные инкременты (кандидаты в эпики)**
  - Функциональность разбита на 3–10 логичных “кусочков” (организация окружения, ingest, claim, работа с внешним API, генерация артефактов, observability, deploy и т.п.).
  - Каждый кусок описан так, чтобы его можно было оформить отдельным эпиком.

- [ ] **Acceptance‑критерии по инкрементам**
  - Для каждого такого “куска” есть 2–5 конкретных пунктов, что именно должно работать/быть реализовано.
  - Приёмка описана на уровне поведения (сценарии, инварианты), а не реализации.

- [ ] **Список открытых вопросов с приоритетами**
  - Все известные неизвестности перечислены явно.
  - У каждого вопроса есть флаг:  
    “блокирует ли планирование/реализацию” или “можно уточнить позже без ломки контракта”.

- [ ] **Модель сред и базовая стратегия деплоя**
  - Перечень сред: локально, CI, test/staging, prod (и при наличии — отдельные dev‑проекты).
  - Понятно, где компонент физически живёт (Cloud Run/Functions/K8s/VM и т.п.) и каким классом инструментов раскатывается (gcloud/helm/terraform/CI‑pipeline).
  - Если для разработки/тестирования/продакшна нужны среды, отличные от локальной, обычно целесообразно выделить отдельный эпик: организация окружения + процесс деплоя и запуска (docker/k8s/serverless и т.п.).

- [ ] **Черновой план отката**
  - Описано, как вернуть компонент на предыдущую ревизию/версию.
  - Описано, что происходит с данными/очередями/долгоживущими джобами/процессами при откате (в общих чертах).

Если какой‑то из критически необходимых пунктов не закрыт, документация **не готова** для стартовой декомпозиции на эпики.

---

## 2. Необходимые пункты  
_Очень желательно для качественного планирования, но формально не стоппер._

- [ ] **Product‑формулировка ценности компонента**
  - Кратко описано, какую продуктовую/бизнес‑ценность даёт компонент.
  - Есть ссылки на глобальные требования к комплексной системе/продукту, с которыми он соотносится.

- [ ] **Список ссылок на глобальные спеки/руководства**
  - Явно перечислены релевантные разделы общих документов.
  - Для каждой ссылки пояснено “что именно отсюда обязательно для этого компонента”.

- [ ] **Карта потоков (high‑level flow)**
  - Есть текстовая или схематичная “дорожка” от триггера до результата с ключевыми шагами.

- [ ] **Человеческое описание ключевых полей схем**
  - Для важных полей указано назначение, допустимые значения, единицы измерения, edge‑кейсы.

- [ ] **Эталонные примеры (test vectors)**
  - Есть хотя бы по одному реалистичному примеру валидного входа/выхода.
  - Есть хотя бы один пример, который должен приводить к типовой ошибке (валидация, лимиты и т.п.).

- [ ] **Правила именования и URI‑контракты**
  - Описаны формулы для путей/имён/идентификаторов (с примерами).
  - Описано, какие данные строго не попадают в имена (секреты, PII, “kind” и др.).

- [ ] **Список конфигурации и секретов + правила валидации**
  - Перечень env‑переменных, флагов, конфиг‑файлов, краткое описание каждого.
  - Правила валидации критичных конфигов (форматы, допустимые режимы, обязательность).

- [ ] **Расширенная классификация ошибок**
  - Для кодов ошибок описано, какие из них:
    - ретраибельные,
    - неретраибельные,
    - лимитные/квотные.
  - Описано, в каком слое и как ожидаются ретраи.

- [ ] **Ожидания по производительности и лимитам**
  - Примерный диапазон нагрузки (частота событий, размеры, целевые SLO/SLA).
  - Важные внешние/внутренние лимиты (rate limits, quotas) и общие подходы к их соблюдению.

- [ ] **Расширенный контракт логов и observability**
  - Полный список событий, которые желательно логировать:  
    ingest, claim/selection, внешние вызовы start/finish, запись артефактов, завершение шага/операции, лимитные/критические ошибки.
  - Прикидка, какие метрики/дашборды будут строиться поверх этих логов.

- [ ] **Ожидания по типам тестов**
  - Какие юнит‑тесты обязательны (схемы, инварианты, базовые happy‑path/error‑path).
  - Какие интеграционные/сценарные тесты предполагаются (mock‑режим, фейки, локальный harness).

- [ ] **Области, вынесенные поверх MVP**
  - Список аспектов, которые сознательно оставлены на post‑MVP/hardening.
  - Для каждого описано, какие риски берутся при такой отсрочке.

- [ ] **Implementation‑чек‑лист**
  - Сводный список технических требований (контракты, схемы, инварианты, логи, безопасность), на который смогут ссылаться все будущие эпики.

- [ ] **Различия конфигурации по средам**
  - Описано, что отличается между dev/test/staging/prod (URL, ключи, режимы, quotas).
  - Явно зафиксированы режимы/фичи, которые запрещены или обязательны в проде и/или в CI.

- [ ] **Smoke‑сценарии для деплоя в test/staging/prod**
  - Есть минимальный набор проверок “сервис жив и делает базовую работу” после выката в каждую среду (команды/запросы/ожидаемые артефакты/логи).

- [ ] **Уточнения по миграциям и совместимости версий**
  - Описано, требуются ли миграции схем/данных, в общих чертах — как они будут выполняться.
  - Описаны требования backward/forward‑совместимости, если компоненты могут обновляться не одновременно.

- [ ] **Ограничения по сети и внешнему доступу**
  - Описано, что гарантированно оффлайн в CI/test.
  - Описано, какие внешние интеграции доступны только в prod‑подобных средах и как они будут эмулироваться в тесте.

- [ ] **Базовое описание мониторинга раскатки**
  - Описано, какие метрики/логи проверяются после выката, чтобы понять “всё ок / нужно откатываться”.

---

## 3. Желательные пункты  
_Улучшают качество и скорость, но не блокируют старт._

- [ ] **Детальная карта “MVP → post‑MVP → hardening”**
  - По каждому инкременту (будущему эпику) есть пометка, в какую фазу он попадает.
  - Есть стратегия: какой минимальный MVP выводится в прод и как дальше наращивается качество.

- [ ] **Более полный набор тест‑векторов**
  - Несколько независимых наборов входов/выходов для разных сценариев, включая edge‑кейсы.
  - “Golden‑files” для сложных артефактов, чтобы можно было сразу писать snapshot‑тесты.

- [ ] **Спецификация QA‑harness’а и offline‑режима**
  - Описан план harness’а для интеграционных тестов (фейки/эмуляторы Firestore/GCS, внешних API и т.п.).
  - Зафиксированы гарантии, что в CI не ходим в реальные внешние сервисы.

- [ ] **План по метрикам, алёртам и дашбордам**
  - Прикидка ключевых alert‑сценариев (лимиты, рост ошибок, увеличенная латентность и т.п.).
  - Черновой список лог‑фильтров/метрик, на которые в будущем будут навешаны алёрты.

- [ ] **Стратегия поэтапной раскатки**
  - Идеи по canary/blue‑green/по‑регионной раскатке (если релевантно компоненту).
  - Критерии, по которым расширяем rollout или останавливаемся/откатываемся.

- [ ] **Явное сопоставление “блоки спеки → эпики”**
  - Таблица/раздел, где логические блоки спецификации примерно сопоставлены будущим эпикам.
  - Это ускоряет планирование и делает WBS более прозрачным.

---

### Итоговый критерий готовности

Документация и спецификации компонента считаются готовыми к передаче в планирование и декомпозицию, если:
- все **критически необходимые** пункты закрыты;
- большая часть **необходимых** пунктов покрыта (оставшиеся имеют понятные причины, почему они отложены);
- по **желательным** пунктам хотя бы понятно, что именно было бы полезно добавить позже.
