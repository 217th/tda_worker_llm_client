{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
	  "$id": "https://example.local/schemas/llm_report_file.schema.json",
	  "title": "LLMReportFile",
	  "description": "Канонический артефакт LLM отчёта: metadata + output (structured JSON: summary + details).",
	  "type": "object",
	  "additionalProperties": false,
	  "required": ["metadata", "output"],
	  "properties": {
		    "metadata": {
	      "type": "object",
	      "additionalProperties": false,
	      "required": ["runId", "stepId", "createdAt", "finishedAt", "symbol", "timeframe", "llm", "inputs"],
	      "properties": {
	        "runId": {
	          "type": "string",
	          "description": "Flow run docId.",
	          "pattern": "^[0-9]{8}-[0-9]{6}_[A-Z0-9]+(?:-[A-Z0-9]+)*_[a-z0-9]{3,6}$"
	        },
	        "stepId": { "type": "string", "minLength": 1 },
	        "createdAt": { "type": "string", "format": "date-time" },
	        "finishedAt": {
	          "type": "string",
	          "format": "date-time",
	          "description": "Completion timestamp for the LLM report generation (often equal to createdAt)."
	        },
	        "symbol": { "type": "string", "minLength": 1 },
	        "timeframe": { "type": "string", "minLength": 1 },
	        "llm": {
	          "type": "object",
	          "additionalProperties": false,
	          "required": ["promptId", "modelId", "finishReason"],
	          "properties": {
	            "promptId": { "type": "string", "minLength": 1 },
	            "modelId": { "type": "string", "minLength": 1 },
	            "modelVersion": { "type": "string" },
	            "finishReason": { "type": "string", "minLength": 1 },
	            "usageMetadata": {
	              "type": "object",
	              "additionalProperties": true,
	              "properties": {
	                "promptTokenCount": { "type": "integer", "minimum": 0 },
	                "cachedContentTokenCount": { "type": "integer", "minimum": 0 },
	                "candidatesTokenCount": { "type": "integer", "minimum": 0 },
	                "toolUsePromptTokenCount": { "type": "integer", "minimum": 0 },
	                "totalTokenCount": { "type": "integer", "minimum": 0 },
	                "thoughtsTokenCount": { "type": "integer", "minimum": 0 }
	              }
	            },
	            "thoughtSignature": { "type": "string" }
	          }
	        },
	        "inputs": {
	          "type": "object",
	          "additionalProperties": false,
	          "required": ["ohlcv_gcs_uri", "charts_outputsManifestGcsUri"],
	          "properties": {
            "ohlcv_gcs_uri": {
              "type": "string",
              "description": "GCS URI (canonical form: `gs://...`).",
              "pattern": "^gs://.+"
            },
	            "charts_outputsManifestGcsUri": {
	              "type": "string",
	              "description": "GCS URI (canonical form: `gs://...`).",
	              "pattern": "^gs://.+"
	            },
	            "report_gcs_uris": {
	              "type": "array",
	              "description": "Optional: GCS URIs of previous reports used as context.",
	              "items": { "type": "string", "pattern": "^gs://.+" }
	            }
	          }
	        }
		      }
		    },
	    "output": {
	      "type": "object",
	      "additionalProperties": false,
	      "required": ["summary", "details"],
	      "properties": {
	        "summary": {
	          "type": "object",
	          "additionalProperties": false,
	          "required": ["markdown"],
	          "properties": {
	            "markdown": {
	              "type": "string",
	              "description": "Человекопонятное краткое резюме."
	            },
	            "html": {
	              "type": "string",
	              "description": "Опционально: HTML версия summary (если генерируется)."
	            }
	          }
	        },
	        "details": {
	          "type": "object",
	          "description": "Большой JSON с подробностями отчёта (структура может эволюционировать).",
	          "additionalProperties": true
	        }
	      }
	    }
	  }
	}


