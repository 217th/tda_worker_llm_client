{
  "schemaId": "llm_report_output_v4",
  "kind": "LLM_REPORT_OUTPUT",
  "createdAt": "2026-01-01T00:00:00Z",
  "description": "Simplified depth-5 variant of v3 for nesting-limit experiments.",
  "jsonSchema": {
    "type": "object",
    "additionalProperties": false,
    "required": [
      "summary",
      "details"
    ],
    "properties": {
      "summary": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "markdown"
        ],
        "properties": {
          "markdown": {
            "type": "string",
            "description": "Human-readable report summary in Markdown."
          }
        }
      },
      "details": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "timeframe",
          "symbol",
          "as_of_date",
          "trend",
          "waves",
          "wave_scenarios",
          "patterns",
          "key_levels",
          "indicators_summary",
          "risks_and_limitations",
          "scenarios",
          "analysis_confidence",
          "agent_recommendations",
          "summary_for_next_timeframes"
        ],
        "properties": {
          "timeframe": {
            "type": "string"
          },
          "symbol": {
            "type": "string"
          },
          "as_of_date": {
            "type": "string",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          "trend": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "direction",
              "phase",
              "description"
            ],
            "properties": {
              "direction": {
                "type": "string",
                "enum": [
                  "bull",
                  "bear",
                  "sideways"
                ]
              },
              "phase": {
                "type": "string",
                "enum": [
                  "impulse",
                  "correction",
                  "consolidation"
                ]
              },
              "description": {
                "type": "string"
              }
            }
          },
          "waves": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "label",
                "degree",
                "start_date",
                "start_price",
                "end_date",
                "end_price",
                "confidence"
              ],
              "properties": {
                "label": {
                  "type": "string"
                },
                "degree": {
                  "type": "string",
                  "enum": [
                    "cycle",
                    "primary",
                    "intermediate",
                    "minor"
                  ]
                },
                "start_date": {
                  "type": "string",
                  "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                },
                "start_price": {
                  "type": "number"
                },
                "end_date": {
                  "anyOf": [
                    {
                      "type": "string",
                      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                    },
                    {
                      "type": "null"
                    }
                  ]
                },
                "end_price": {
                  "anyOf": [
                    {
                      "type": "number"
                    },
                    {
                      "type": "null"
                    }
                  ]
                },
                "confidence": {
                  "type": "string",
                  "enum": [
                    "High",
                    "Medium",
                    "Low"
                  ]
                }
              }
            }
          },
          "wave_scenarios": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "id",
                "probability",
                "description",
                "waves",
                "score"
              ],
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^WS[1-9][0-9]*$"
                },
                "probability": {
                  "type": "string",
                  "enum": [
                    "High",
                    "Medium",
                    "Low"
                  ]
                },
                "description": {
                  "type": "string"
                },
                "waves": {
                  "type": "string",
                  "description": "Comma-separated wave labels."
                },
                "score": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 100
                }
              }
            }
          },
          "patterns": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "name",
                "direction",
                "price_zone",
                "description"
              ],
              "properties": {
                "name": {
                  "type": "string"
                },
                "direction": {
                  "type": "string",
                  "enum": [
                    "bullish",
                    "bearish",
                    "neutral"
                  ]
                },
                "price_zone": {
                  "type": "string",
                  "description": "Text summary of zone, e.g. '120-135'."
                },
                "description": {
                  "type": "string"
                }
              }
            }
          },
          "key_levels": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "type",
                "level",
                "note"
              ],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "support",
                    "resistance",
                    "vpvr_poc",
                    "vpvr_hvn",
                    "vpvr_lvn",
                    "fib",
                    "ma"
                  ]
                },
                "level": {
                  "type": "number"
                },
                "note": {
                  "type": "string"
                }
              }
            }
          },
          "indicators_summary": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "ma",
              "bb",
              "macd",
              "rsi",
              "adx"
            ],
            "properties": {
              "ma": {
                "type": "string"
              },
              "bb": {
                "type": "string"
              },
              "macd": {
                "type": "string"
              },
              "rsi": {
                "type": "string"
              },
              "adx": {
                "type": "string"
              }
            }
          },
          "risks_and_limitations": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "scenarios": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "id",
                "name",
                "role",
                "probability",
                "direction",
                "time_horizon",
                "targets",
                "rationale",
                "score_total"
              ],
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^S[1-9][0-9]*$"
                },
                "name": {
                  "type": "string"
                },
                "role": {
                  "type": "string",
                  "enum": [
                    "base",
                    "bullish",
                    "bearish",
                    "other"
                  ]
                },
                "probability": {
                  "type": "string",
                  "enum": [
                    "High",
                    "Medium",
                    "Low"
                  ]
                },
                "direction": {
                  "type": "string",
                  "enum": [
                    "up",
                    "down",
                    "sideways"
                  ]
                },
                "time_horizon": {
                  "type": "string"
                },
                "targets": {
                  "type": "string",
                  "description": "Text summary of targets."
                },
                "rationale": {
                  "type": "string"
                },
                "score_total": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 100
                }
              }
            }
          },
          "analysis_confidence": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "overall_confidence",
              "comment"
            ],
            "properties": {
              "overall_confidence": {
                "type": "number",
                "minimum": 0.0,
                "maximum": 1.0
              },
              "comment": {
                "type": "string"
              }
            }
          },
          "agent_recommendations": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "summary_for_next_timeframes": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "one_line",
              "key_points"
            ],
            "properties": {
              "one_line": {
                "type": "string"
              },
              "key_points": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  },
  "sha256": "50f4cc981dfe2bdfa1d2fc1bde623b4ffe6c1285e9a82181b9d0bf887f6d6517",
  "isActive": true
}